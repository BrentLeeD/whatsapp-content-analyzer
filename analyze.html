<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Content Analyzer</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
</head>
<body class="bg-gray-50" onload="checkUrlParams()">
    <div class="w-full max-w-4xl mx-auto p-4 space-y-4">
        <!-- Input Section -->
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
            <div class="p-4 border-b">
                <h2 class="flex items-center gap-2 text-xl font-semibold">
                    <i data-lucide="message-square" class="w-6 h-6 text-green-600"></i>
                    WhatsApp Content Analyzer
                </h2>
            </div>
            <div class="p-4">
                <textarea
                    id="content-input"
                    class="w-full h-48 p-4 border rounded-md mb-4 font-mono text-gray-800"
                    placeholder="Paste your WhatsApp content here..."
                ></textarea>
                <button
                    id="analyze-btn"
                    class="px-6 py-2 bg-green-600 text-white rounded-md hover:bg-green-700 transition-colors"
                >
                    Analyze
                </button>
            </div>
        </div>

        <!-- Analysis Results (Initially Hidden) -->
        <div id="analysis-results" class="hidden space-y-4">
            <!-- Summary Box -->
            <div class="bg-white rounded-lg shadow-sm overflow-hidden bg-gradient-to-r from-green-50 to-blue-50">
                <div class="p-6">
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                        <div class="text-center p-4 bg-white rounded-lg shadow-sm">
                            <p class="text-sm text-gray-600">Length Category</p>
                            <p id="length-category" class="text-lg font-semibold"></p>
                            <p id="char-count" class="text-xs text-gray-500"></p>
                        </div>
                        
                        <div class="text-center p-4 bg-white rounded-lg shadow-sm">
                            <p class="text-sm text-gray-600">Truncation Risk</p>
                            <p id="truncation-risk" class="text-lg font-semibold"></p>
                            <p id="line-count" class="text-xs text-gray-500"></p>
                        </div>

                        <div class="text-center p-4 bg-white rounded-lg shadow-sm">
                            <p class="text-sm text-gray-600">Reading Level</p>
                            <p id="cefr-level" class="text-lg font-semibold text-blue-600"></p>
                            <p class="text-xs text-gray-500">CEFR Scale</p>
                        </div>

                        <div class="text-center p-4 bg-white rounded-lg shadow-sm">
                            <p class="text-sm text-gray-600">Structure</p>
                            <p id="paragraph-count" class="text-lg font-semibold text-gray-800"></p>
                            <p id="words-per-paragraph" class="text-xs text-gray-500"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Analysis -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Content Structure -->
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <div class="p-4 border-b">
                        <h3 class="flex items-center gap-2 text-lg font-semibold">
                            <i data-lucide="layout" class="w-5 h-5"></i>
                            Content Structure
                        </h3>
                    </div>
                    <div class="p-4">
                        <div class="space-y-3">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Formatting Used:</p>
                                <div class="flex gap-4 mt-1">
                                    <span id="bold-count">Bold: 0</span>
                                    <span id="italic-count">Italic: 0</span>
                                    <span id="bullet-count">Bullets: 0</span>
                                </div>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-600">Rich Elements:</p>
                                <div class="flex gap-4 mt-1">
                                    <span id="emoji-count">Emojis: 0</span>
                                    <span id="link-count">Links: 0</span>
                                    <span id="hashtag-count">Hashtags: 0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Readability Analysis -->
                <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                    <div class="p-4 border-b">
                        <h3 class="flex items-center gap-2 text-lg font-semibold">
                            <i data-lucide="book" class="w-5 h-5"></i>
                            Readability Analysis
                        </h3>
                    </div>
                    <div class="p-4">
                        <div class="space-y-3">
                            <div>
                                <p class="text-sm font-medium text-gray-600">Grade Level:</p>
                                <p id="flesch-kincaid">Flesch-Kincaid: 0</p>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-600">CEFR Level Explained:</p>
                                <p id="cefr-explanation" class="text-sm text-gray-600"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Lucide icons
        lucide.createIcons({
            attrs: {
                class: ["w-6 h-6"],
                strokeWidth: "1.5"
            }
        });
 function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const content = urlParams.get('content');
            
            if (content) {
                // Decode the content and put it in the textarea
                const decodedContent = decodeURIComponent(content);
                document.getElementById('content-input').value = decodedContent;
                // Automatically trigger analysis
                analyzeContent();
            }
        }
        // Helper functions
        function countSyllables(word) {
            if (word.length <= 3) return 1;
            word = word.replace(/(?:[^laeiouy]es|ed|[^laeiouy]e)$/, '');
            word = word.replace(/^y/, '');
            const syllables = word.match(/[aeiouy]{1,2}/g);
            return syllables ? syllables.length : 1;
        }

        function calculateFleschKincaid(words, sentences, syllables) {
            if (sentences === 0) return 0;
            return 0.39 * (words / sentences) + 11.8 * (syllables / words) - 15.59;
        }

        function estimateCEFR(fleschKincaid) {
            if (fleschKincaid <= 3) return 'A1';
            if (fleschKincaid <= 5) return 'A2';
            if (fleschKincaid <= 7) return 'B1';
            if (fleschKincaid <= 10) return 'B2';
            if (fleschKincaid <= 13) return 'C1';
            return 'C2';
        }

        function getLengthCategory(chars) {
            if (chars <= 500) return { category: 'Concise', color: 'text-green-600' };
            if (chars <= 700) return { category: 'Golden', color: 'text-green-600' };
            if (chars <= 900) return { category: 'Extended', color: 'text-yellow-600' };
            if (chars <= 1100) return { category: 'Long', color: 'text-orange-600' };
            return { category: 'Very Long', color: 'text-red-600' };
        }

        // Main analysis function
        function analyzeContent() {
            const text = document.getElementById('content-input').value;
            
            if (!text.trim()) {
                document.getElementById('analysis-results').classList.add('hidden');
                return;
            }

            // Remove formatting symbols for true character count
            const cleanText = text.replace(/[\*_~]/g, '');
            const characterCount = cleanText.length;
            
            // Content structure analysis
            const lines = text.split('\n').filter(line => line.trim().length > 0);
            const paragraphs = text.split('\n\n').filter(p => p.trim().length > 0);
            const words = cleanText.match(/\b\w+\b/g) || [];
            
            // Calculate reading metrics
            const syllableCount = words.reduce((count, word) => {
                return count + countSyllables(word.toLowerCase());
            }, 0);
            
            const fleschKincaid = calculateFleschKincaid(words.length, paragraphs.length, syllableCount);
            const cefr = estimateCEFR(fleschKincaid);

            // Format analysis
            const formatting = {
                bold: (text.match(/\*(.*?)\*/g) || []).length,
                italics: (text.match(/_(.*?)_/g) || []).length,
                bulletPoints: (text.match(/^[â€¢\-\*]\s/gm) || []).length,
            };

            // Media and engagement elements
            const emojiCount = (text.match(/[\p{Emoji}]/gu) || []).length;
            const urls = (text.match(/https?:\/\/[^\s]+/g) || []);
            const hashtags = (text.match(/#[^\s#]+/g) || []);

            // Update the UI
            const lengthCategory = getLengthCategory(characterCount);
            document.getElementById('length-category').className = `text-lg font-semibold ${lengthCategory.color}`;
            document.getElementById('length-category').textContent = lengthCategory.category;
            document.getElementById('char-count').textContent = `${characterCount} characters`;

            const truncationRisk = lines.length > 8 ? 'High' : 'Low';
            document.getElementById('truncation-risk').className = `text-lg font-semibold ${truncationRisk === 'High' ? 'text-red-600' : 'text-green-600'}`;
            document.getElementById('truncation-risk').textContent = truncationRisk;
            document.getElementById('line-count').textContent = `${lines.length} lines`;

            document.getElementById('cefr-level').textContent = cefr;
            document.getElementById('paragraph-count').textContent = `${paragraphs.length} paragraphs`;
            document.getElementById('words-per-paragraph').textContent = `~${Math.round(words.length / paragraphs.length)} words each`;

            document.getElementById('bold-count').textContent = `Bold: ${formatting.bold}`;
            document.getElementById('italic-count').textContent = `Italic: ${formatting.italics}`;
            document.getElementById('bullet-count').textContent = `Bullets: ${formatting.bulletPoints}`;

            document.getElementById('emoji-count').textContent = `Emojis: ${emojiCount}`;
            document.getElementById('link-count').textContent = `Links: ${urls.length}`;
            document.getElementById('hashtag-count').textContent = `Hashtags: ${hashtags.length}`;

            document.getElementById('flesch-kincaid').textContent = `Flesch-Kincaid: ${Math.round(fleschKincaid * 10) / 10}`;

            const cefrExplanation = cefr === 'B2' ? 
                'Upper Intermediate - suitable for most WhatsApp users' :
                cefr === 'B1' ?
                'Intermediate - ideal for wide reach' :
                cefr === 'C1' || cefr === 'C2' ?
                'Advanced - consider simplifying for broader reach' :
                'Basic - very accessible to most readers';
            
            document.getElementById('cefr-explanation').textContent = cefrExplanation;

            // Show results
            document.getElementById('analysis-results').classList.remove('hidden');
        }

        // Event listeners
        document.getElementById('analyze-btn').addEventListener('click', analyzeContent);
        document.getElementById('content-input').addEventListener('keyup', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                analyzeContent();
            }
        });
    </script>
</body>
</html>
